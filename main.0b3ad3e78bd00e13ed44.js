"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[179],{938:function(t,e,n){var i=document.querySelector(".tickets-list"),r=document.querySelector(".preloader-modal"),s=document.querySelector(".error-modal"),a=document.querySelector(".error-modal__text");function o(t){a.textContent=t,s.classList.remove("visually-hidden"),setTimeout((function(){s.classList.add("visually-hidden")}),2e3)}function c(t,e,n,i,r,s,a){try{var o=t[s](a),c=o.value}catch(t){return void n(t)}o.done?e(c):Promise.resolve(c).then(i,r)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var s=t.apply(e,n);function a(t){c(s,i,r,a,o,"next",t)}function o(t){c(s,i,r,a,o,"throw",t)}a(void 0)}))}}var m="https://ahj7-http-backend.herokuapp.com";function d(t,e){return u.apply(this,arguments)}function u(){return(u=l(regeneratorRuntime.mark((function t(e,n){var i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.classList.remove("visually-hidden"),t.prev=1,t.next=4,fetch(e,n);case 4:if((i=t.sent).ok){t.next=7;break}throw new Error(i.statusText);case 7:return t.next=9,i.json();case 9:return s=t.sent,r.classList.add("visually-hidden"),t.abrupt("return",s);case 14:throw t.prev=14,t.t0=t.catch(1),r.classList.add("visually-hidden"),new Error(t.t0.message);case 18:case"end":return t.stop()}}),t,null,[[1,14]])})))).apply(this,arguments)}function h(){return(h=l(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d("".concat(m,"?method=allTickets"),{method:"GET"}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(){return(p=l(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d("".concat(m,"?method=ticketById&id=").concat(e),{method:"GET"}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function f(){return(f=l(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d("".concat(m,"?method=ticketSetStatus&id=").concat(e,"&status=").concat(n),{method:"PATCH"}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function E(){return(E=l(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d("".concat(m,"?method=createTicket"),{method:"POST",body:e}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(){return(k=l(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d("".concat(m,"?method=removeTicket&id=").concat(e),{method:"DELETE"}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(){return(v=l(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d("".concat(m,"?method=editTicket"),{method:"PATCH",body:e}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var y=n(6589);function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var x=function(){function t(e,n,i,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";b(this,t),this.id=e,this.name=n,this.status=i;var a=new Date(r);"Invalid Date"===a.toString()?this.created=r:this.created=(0,y.Z)(new Date(r),"dd.MM.yy HH:mm"),this.description=s}var e,n,i;return e=t,(n=[{key:"createDOM",value:function(){this.ticketItemElement=document.createElement("li"),this.ticketItemElement.setAttribute("data-id",this.id),this.ticketBasicElement=document.createElement("div"),this.ticketFulfilledElement=document.createElement("div"),this.ticketTextElement=document.createElement("p"),this.ticketTextElement.textContent=this.name,this.ticketCreatedElement=document.createElement("p"),this.ticketCreatedElement.textContent=this.created,this.ticketButtonActionWrapperElement=document.createElement("div"),this.ticketEditButtonElement=document.createElement("button"),this.ticketEditButtonElement.textContent="✎",this.ticketRemoveButtonElement=document.createElement("button"),this.ticketRemoveButtonElement.textContent="x",this.ticketDescriptionElement=document.createElement("p"),this.ticketDescriptionElement.textContent="",this.ticketItemElement.append(this.ticketBasicElement),this.ticketItemElement.append(this.ticketDescriptionElement),this.ticketBasicElement.append(this.ticketFulfilledElement),this.ticketBasicElement.append(this.ticketTextElement),this.ticketBasicElement.append(this.ticketCreatedElement),this.ticketBasicElement.append(this.ticketButtonActionWrapperElement),this.ticketButtonActionWrapperElement.append(this.ticketEditButtonElement),this.ticketButtonActionWrapperElement.append(this.ticketRemoveButtonElement)}},{key:"addStyles",value:function(){this.ticketItemElement.classList.add("tickets-list__item"),this.ticketBasicElement.classList.add("tickets-list__basic"),this.ticketFulfilledElement.classList.add("tickets-list__fulfilled"),!0===this.status&&this.ticketFulfilledElement.classList.add("tickets-list__fulfilled_checked"),this.ticketTextElement.classList.add("tickets-list__text"),this.ticketCreatedElement.classList.add("tickets-list__created"),this.ticketButtonActionWrapperElement.classList.add("button-action-wrapper"),this.ticketEditButtonElement.classList.add("button","button-action-wrapper__edit-button"),this.ticketRemoveButtonElement.classList.add("button","button-action-wrapper__remove-button"),this.ticketDescriptionElement.classList.add("tickets-list__description","visually-hidden")}},{key:"addToDOM",value:function(){return this.createDOM(),this.addStyles(),this.ticketItemElement}},{key:"showDescription",value:function(){this.ticketItemElement=document.querySelector('[data-id="'.concat(this.id,'"]')),this.ticketItemElement&&(this.ticketDescriptionElement=this.ticketItemElement.querySelector(".tickets-list__description"),this.ticketDescriptionElement&&(this.ticketDescriptionElement.textContent=this.description,this.ticketDescriptionElement.classList.remove("visually-hidden")))}},{key:"update",value:function(){this.ticketItemElement=document.querySelector('[data-id="'.concat(this.id,'"]')),this.ticketItemElement&&(this.ticketFulfilledElement=this.ticketItemElement.querySelector(".tickets-list__fulfilled"),this.ticketFulfilledElement&&(!0===this.status?this.ticketFulfilledElement.classList.add("tickets-list__fulfilled_checked"):this.ticketFulfilledElement.classList.remove("tickets-list__fulfilled_checked")),this.ticketTextElement=this.ticketItemElement.querySelector(".tickets-list__text"),this.ticketTextElement&&(this.ticketTextElement.textContent=this.name),this.ticketDescriptionElement=this.ticketItemElement.querySelector(".tickets-list__description"),this.ticketDescriptionElement&&(this.ticketDescriptionElement.textContent=this.description))}},{key:"remove",value:function(){this.ticketItemElement=document.querySelector('[data-id="'.concat(this.id,'"]')),this.ticketItemElement&&this.ticketItemElement.remove()}}])&&_(e.prototype,n),i&&_(e,i),t}();function w(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var L=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.operation=e,this.title=n,this.data=i,this.createDOM(),this.addStyles(),this.addListeners()}var e,n,r;return e=t,(n=[{key:"createDOM",value:function(){switch(this.modalElement=document.createElement("div"),this.formElement=document.createElement("form"),this.formContentElement=document.createElement("div"),this.formHeaderElement=document.createElement("div"),this.formTitleElement=document.createElement("h4"),this.formTitleElement.textContent=this.title,this.formBodyElement=document.createElement("div"),this.operation){case"add":case"edit":this.formLabelNameElement=document.createElement("label"),this.formLabelNameElement.setAttribute("for","name"),this.formLabelNameElement.textContent="Краткое описание",this.formInputNameElement=document.createElement("input"),this.formInputNameElement.setAttribute("type","text"),this.formInputNameElement.setAttribute("id","name"),this.formInputNameElement.setAttribute("name","name"),this.formInputNameElement.setAttribute("required",""),this.formInputNameElement.value=this.data.name,this.formLabelDescriptionElement=document.createElement("label"),this.formLabelDescriptionElement.setAttribute("for","description"),this.formLabelDescriptionElement.textContent="Подробное описание",this.formTextAreaDescriptionElement=document.createElement("textarea"),this.formTextAreaDescriptionElement.setAttribute("id","description"),this.formTextAreaDescriptionElement.setAttribute("name","description"),this.formTextAreaDescriptionElement.setAttribute("rows","3"),this.formTextAreaDescriptionElement.value=this.data.description,this.formBodyElement.append(this.formLabelNameElement),this.formBodyElement.append(this.formInputNameElement),this.formBodyElement.append(this.formLabelDescriptionElement),this.formBodyElement.append(this.formTextAreaDescriptionElement);break;case"remove":this.formTextElement=document.createElement("p"),this.formTextElement.textContent="Вы уверены, что хотите удалить тикет? Это действие необратимо.",this.formBodyElement.append(this.formTextElement)}this.formFooterElement=document.createElement("div"),this.formButtonsWrapperElement=document.createElement("div"),this.formCancelButtonElement=document.createElement("button"),this.formCancelButtonElement.textContent="Отмена",this.formOkButtonElement=document.createElement("button"),this.formOkButtonElement.textContent="Ок",this.modalElement.append(this.formElement),this.formElement.append(this.formContentElement),this.formContentElement.append(this.formHeaderElement),this.formContentElement.append(this.formBodyElement),this.formContentElement.append(this.formFooterElement),this.formHeaderElement.append(this.formTitleElement),this.formFooterElement.append(this.formButtonsWrapperElement),this.formButtonsWrapperElement.append(this.formCancelButtonElement),this.formButtonsWrapperElement.append(this.formOkButtonElement)}},{key:"addStyles",value:function(){this.modalElement.classList.add("modal"),this.formElement.classList.add("modal-dialog"),this.formContentElement.classList.add("modal-dialog__content"),this.formHeaderElement.classList.add("modal-dialog__header"),this.formTitleElement.classList.add("modal-dialog__title"),this.formBodyElement.classList.add("modal-dialog__body"),this.formLabelNameElement&&this.formLabelNameElement.classList.add("modal-dialog__label"),this.formLabelDescriptionElement&&this.formLabelDescriptionElement.classList.add("modal-dialog__label"),this.formInputNameElement&&this.formInputNameElement.classList.add("modal-dialog__input"),this.formTextAreaDescriptionElement&&this.formTextAreaDescriptionElement.classList.add("modal-dialog__textarea"),this.formTextElement&&this.formTextElement.classList.add("modal-dialog__text"),this.formFooterElement.classList.add("modal-dialog__footer"),this.formButtonsWrapperElement.classList.add("modal-button-wrapper"),this.formCancelButtonElement.classList.add("button","modal-button-wrapper__button"),this.formOkButtonElement.classList.add("button","modal-button-wrapper__button")}},{key:"addListeners",value:function(){var t=this;this.formCancelButtonElement.addEventListener("click",(function(e){e.preventDefault(),t.modalElement.remove(t)})),this.formElement.addEventListener("submit",(function(e){switch(e.preventDefault(),t.operation){case"add":var n=new FormData;n.append("name",t.formInputNameElement.value),n.append("description",t.formTextAreaDescriptionElement.value),function(t){return E.apply(this,arguments)}(n).then((function(t){i.append(new x(t.id,t.name,t.status,t.created).addToDOM())})).catch((function(t){o(t.message)}));break;case"remove":(function(t){return k.apply(this,arguments)})(t.data.id).then((function(t){new x(t.id,t.name,t.status,t.created).remove()})).catch((function(t){o(t.message)}));break;case"edit":var r=new FormData;r.append("id",t.data.id),r.append("name",t.formInputNameElement.value),r.append("description",t.formTextAreaDescriptionElement.value),function(t){return v.apply(this,arguments)}(r).then((function(t){new x(t.id,t.name,t.status,t.created,t.description).update()})).catch((function(t){o(t.message)}))}t.modalElement.remove(t)}))}},{key:"show",value:function(){return this.modalElement}}])&&w(e.prototype,n),r&&w(e,r),t}();document.querySelector(".button").addEventListener("click",(function(){var t=new L("add","Добавить тикет",{id:null,name:"",description:"",status:!1,created:""});document.body.append(t.show())})),i.addEventListener("click",(function(t){var e=t.target.closest(".tickets-list__item");if(e){var n=function(t){var e=t.dataset.id,n=t.querySelector(".tickets-list__text"),i=t.querySelector(".tickets-list__description"),r=t.querySelector(".tickets-list__created"),s=t.querySelector(".tickets-list__fulfilled").classList.contains("tickets-list__fulfilled_checked");return{id:e,name:n.textContent,description:i.textContent,status:s,created:r.textContent}}(e),i=t.target.classList;if(i.contains("tickets-list__fulfilled"))(function(t,e){return f.apply(this,arguments)})(n.id,!n.status).then((function(t){new x(t.id,t.name,t.status,t.created,t.description).update()})).catch((function(t){o(t.message)}));else if(i.contains("button-action-wrapper__edit-button")){var r=new L("edit","Изменить тикет",n);document.body.append(r.show())}else if(i.contains("button-action-wrapper__remove-button")){var s=new L("remove","Удалить тикет",n);document.body.append(s.show())}else{var a=document.querySelector('[data-id="'.concat(n.id,'"]'));if(a){var c=a.querySelector(".tickets-list__description");c&&c.classList.contains("visually-hidden")?function(t){return p.apply(this,arguments)}(n.id).then((function(t){new x(t.id,t.name,t.status,t.created,t.description).showDescription()})).catch((function(t){o(t.message)})):c.classList.add("visually-hidden")}}}})),function(){return h.apply(this,arguments)}().then((function(t){t.map((function(t){return i.append(new x(t.id,t.name,t.status,t.created).addToDOM())}))})).catch((function(t){o(t.message)}))}},function(t){var e=function(e){return t(t.s=e)};t.O(0,[358],(function(){return e(1202),e(938)}));t.O()}]);